#!/bin/bash

# Directory to store Pokémon data
OUTPUT_DIR="pokemon_data"
mkdir -p "$OUTPUT_DIR"

# List of Pokémon to fetch
pokemon_list=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")

# Max retry attempts
MAX_RETRIES=3

# Loop through the Pokémon list
for name in "${pokemon_list[@]}"; do
    echo "Fetching data for $name..."

    name_lower=$(echo "$name" | awk '{ print tolower($0) }')
    output_file="$OUTPUT_DIR/${name_lower}.json"
    api_url="https://pokeapi.co/api/v2/pokemon/${name_lower}"

    success=false
    for attempt in $(seq 1 $MAX_RETRIES); do
        if curl -s -f "$api_url" -o "$output_file"; then
            echo "Saved data to $output_file ✅"
            success=true
            break
        else
            echo "Attempt $attempt for $name failed. Retrying in 2s..."
            sleep 2
        fi
    done

    if [ "$success" = false ]; then
        echo "❌ Failed to fetch data for $name after $MAX_RETRIES attempts" | tee -a errors.txt
    fi

    # Delay to prevent rate-limiting
    sleep 1
done
